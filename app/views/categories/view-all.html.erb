<!-- app/views/categories/view-all.html.erb -->
<h1>All Tasks</h1>

<%= form_with(url: show_joined_table_categories_path, method: :get) do %>
  <div class="form-group">
    <%= label_tag 'due_date', 'Filter by Due Date:' %>
    <%= text_field_tag 'due_date', params[:due_date], class: 'form-control', type: 'date' %>
  </div>
  <%= submit_tag 'Filter', class: 'btn btn-primary' %>
<% end %>

<% if @categories_and_taskapps.present? %>
  <table class="table">
    <thead>
      <tr>
        <th>Category Name</th>
        <th>Task Title</th>
        <th>Task Due Date</th>
      </tr>
    </thead>
    <tbody>
      <% @categories_and_taskapps.each do |category| %>
        <% category.taskapps.each do |taskapp| %>
          <% if params[:due_date].blank? || taskapp.due_date == params[:due_date].to_date %>
            <tr>
              <td><%= category.name %></td>
              <td><%= taskapp.title %></td>
              <td><%= taskapp.due_date %></td>
            </tr>
          <% end %>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No tasks available for this category.</p>
<% end %>

<%= link_to 'Back', categories_path %>
